## TCP-fuzz

### 1. TCP协议栈测试困难：三点

 1.（tcp堆栈接收有依赖关系的数据包与系统调用，）生成有效的测试 用例具有挑战性

2. 现有的测试方法的目标是覆盖状态而不是覆盖状态装换

3. 87%的TCP栈bug与语义错误有关，但现有的bug消毒剂只能检测内存bug，而不是语义错误

### 2. 文中提出了TCP-fuzz解决上述三个挑战

1.提出了一种基于依赖的策略，考虑数据包和系统调用之间的依赖关系，生成有效的测试用例

2.使用一种名为分支转换的新覆盖率度量作为程序反馈，提高状态转换的覆盖率

3.提出了一种差异检查器，比较相同输入的多个tcp协议栈的输出来检测语义错误。（不同的TCP堆栈应该遵循许多相同的语义规则(大多数这些规则是在RFC文档中定义的)，因此它们应该为相同的输入产生相同或相似的输出。否则，这些TCP堆栈存在实现不一致，这表明其中一些堆栈可能存在语义错误。）



TCP协议的具体实现形式，内核级TCP栈 LinuxTCP 和FreeBSDTCP,用户级tcp堆栈mTCP，TLDK和F-stack

TCP协议栈共性三个：

1. 具有依赖关系的二维输入
2. 状态模型。RFC文档中定义了基本的状态模型，总共有11种状态和20种状态转换。对于真实的TCP协议栈会更多
3. 语义规则

### 3.  现有协议模糊测试的局限性

现有模糊测试主要是对应用层协议如DTLS/TLS,FTP/Modbus进行测试，这些方法不能直接用来测试TCP协议

1. 现有的模糊化方法只生成数据包作为输入测试用例，而不考虑输入之间的依赖关系。

2. 忽略了状态转换的覆盖范围。现有的协议模糊方法使用代码覆盖作为程序反馈，来覆盖不同的协议状态

3. 缺乏对语义错误的有效检测。

### 4. 关键技术

三个关键技术分别解决上述的三个局限性

1. 基于依赖的策略。将系统调用以及数据包都作为测试用例
2. 提出了一个新的覆盖度量，称为分支转换来描述状态和状态转换。对于给定的输入序列，一个分支转换被表示为一个向量，该向量既存储当前输入项的分支覆盖，又存储当前和以前输入项之间的分支覆盖的变化

